<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Êó•Ë®ò‰∏ÄË¶ß - Couple OS</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans",sans-serif;
  max-width:900px;margin:0 auto;padding:16px;
  background:#f6f2ff;
}
.card{
  background:#fff;border-radius:16px;padding:14px;margin:14px 0;
  box-shadow:0 8px 24px rgba(0,0,0,.06);
}
img{max-width:100%;border-radius:12px;margin-top:8px}
.muted{font-size:13px;opacity:.7}
.err{color:#b00020;font-size:13px}
</style>
</head>

<body>
<h1>üìî Êó•Ë®ò‰∏ÄË¶ß</h1>
<div class="muted">‰øùÂ≠ò„Åï„Çå„ÅüÊó•Ë®ò„ÇíÊñ∞„Åó„ÅÑÈ†Ü„Å´Ë°®Á§∫„Åó„Åæ„Åô</div>

<div id="error" class="err"></div>
<div id="list"></div>

<script>
const SUPABASE_URL = "https://eycneuftjdooykzjbioy.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_ySwVIipmFAvN6VGexnR0PQ_RDsZ4M2Z";
const COUPLE_ID = "kentaria";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const list = document.getElementById("list");
const errorEl = document.getElementById("error");

function esc(s){
  return (s||"").replace(/[&<>"']/g,c=>(
    {"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]
  ));
}

async function loadDiaries(){
  try{
    const { data, error } = await sb
      .from("diaries")
      .select("*")
      .eq("couple_id", COUPLE_ID)
      .order("created_at", { ascending:false });

    if(error) throw error;

    if(!data || data.length===0){
      list.innerHTML = "<div class='card muted'>Êó•Ë®ò„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>";
      return;
    }

    list.innerHTML = "";
    data.forEach(d=>{
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <div class="muted">${esc(d.date)} / ${new Date(d.created_at).toLocaleString()}</div>
        <h3>${esc(d.title||"ÁÑ°È°å")}</h3>
        <div>${esc(d.body||"")}</div>
        ${d.image_url ? `<img src="${esc(d.image_url)}">` : ""}
      `;
      list.appendChild(div);
    });

  }catch(e){
    errorEl.textContent = e.message;
  }
}

loadDiaries();
</script>
</body>
</html>
